
SELECT t0.business_id AS  WABusinessId
, t0.salesforce_account_id
, a.OwnerId
, U.Name AS OwnerName
, U1.name AS OBName
, a.pISU__c AS ImpDate
, T0.name
, a.TC_Recurly_MRR__c AS MRR
, CASE WHEN A.Trial_Ends_At__c IS NOT NULL THEN 'Trial' ELSE '' END AS Trial
, CASE WHEN T0.[0] IS NULL AND t0.[10] IS NOT NULL THEN t0.[10]
WHEN T0.[0] IS NULL AND t0.[20] IS NOT NULL THEN t0.[20]
WHEN T0.[0] IS NULL AND t0.[30] IS NOT NULL THEN t0.[30]
WHEN T0.[0] IS NULL AND t0.[40] IS NOT NULL THEN t0.[40]
WHEN T0.[0] IS NULL AND t0.[50] IS NOT NULL THEN t0.[50]
WHEN T0.[0] IS NULL AND t0.[60] IS NOT NULL THEN t0.[60]
WHEN T0.[0] IS NULL AND t0.[70] IS NOT NULL THEN t0.[70]
WHEN T0.[0] IS NULL AND t0.[80] IS NOT NULL THEN t0.[80]
WHEN T0.[0] IS NULL AND t0.[90] IS NOT NULL THEN t0.[90]
WHEN T0.[0] IS NULL AND t0.[100] IS NOT NULL THEN t0.[100]
ELSE T0.[0] END AS DaysToFirstInspection,
CASE 
WHEN T0.[10] IS NULL AND t0.[20] IS NOT NULL THEN t0.[20]
WHEN T0.[10] IS NULL AND t0.[30] IS NOT NULL THEN t0.[30]
WHEN T0.[10] IS NULL AND t0.[40] IS NOT NULL THEN t0.[40]
WHEN T0.[10] IS NULL AND t0.[50] IS NOT NULL THEN t0.[50]
WHEN T0.[10] IS NULL AND t0.[60] IS NOT NULL THEN t0.[60]
WHEN T0.[10] IS NULL AND t0.[70] IS NOT NULL THEN t0.[70]
WHEN T0.[10] IS NULL AND t0.[80] IS NOT NULL THEN t0.[80]
WHEN T0.[10] IS NULL AND t0.[90] IS NOT NULL THEN t0.[90]
WHEN T0.[10] IS NULL AND t0.[100] IS NOT NULL THEN t0.[100]
ELSE T0.[10] END AS DaysTo10Percent,
CASE 
WHEN T0.[20] IS NULL AND t0.[30] IS NOT NULL THEN t0.[30]
WHEN T0.[20] IS NULL AND t0.[40] IS NOT NULL THEN t0.[40]
WHEN T0.[20] IS NULL AND t0.[50] IS NOT NULL THEN t0.[50]
WHEN T0.[20] IS NULL AND t0.[60] IS NOT NULL THEN t0.[60]
WHEN T0.[20] IS NULL AND t0.[70] IS NOT NULL THEN t0.[70]
WHEN T0.[20] IS NULL AND t0.[80] IS NOT NULL THEN t0.[80]
WHEN T0.[20] IS NULL AND t0.[90] IS NOT NULL THEN t0.[90]
WHEN T0.[20] IS NULL AND t0.[100] IS NOT NULL THEN t0.[100]
ELSE T0.[20] END AS DaysTo20Percent,
CASE 
WHEN T0.[30] IS NULL AND t0.[40] IS NOT NULL THEN t0.[40]
WHEN T0.[30] IS NULL AND t0.[50] IS NOT NULL THEN t0.[50]
WHEN T0.[30] IS NULL AND t0.[60] IS NOT NULL THEN t0.[60]
WHEN T0.[30] IS NULL AND t0.[70] IS NOT NULL THEN t0.[70]
WHEN T0.[30] IS NULL AND t0.[80] IS NOT NULL THEN t0.[80]
WHEN T0.[30] IS NULL AND t0.[90] IS NOT NULL THEN t0.[90]
WHEN T0.[30] IS NULL AND t0.[100] IS NOT NULL THEN t0.[100]
ELSE T0.[30] END AS DaysTo30Percent,
CASE 
WHEN T0.[40] IS NULL AND t0.[50] IS NOT NULL THEN t0.[50]
WHEN T0.[40] IS NULL AND t0.[60] IS NOT NULL THEN t0.[60]
WHEN T0.[40] IS NULL AND t0.[70] IS NOT NULL THEN t0.[70]
WHEN T0.[40] IS NULL AND t0.[80] IS NOT NULL THEN t0.[80]
WHEN T0.[40] IS NULL AND t0.[90] IS NOT NULL THEN t0.[90]
WHEN T0.[40] IS NULL AND t0.[100] IS NOT NULL THEN t0.[100]
ELSE T0.[40] END AS DaysTo40Percent,
CASE 
WHEN T0.[50] IS NULL AND t0.[60] IS NOT NULL THEN t0.[60]
WHEN T0.[50] IS NULL AND t0.[70] IS NOT NULL THEN t0.[70]
WHEN T0.[50] IS NULL AND t0.[80] IS NOT NULL THEN t0.[80]
WHEN T0.[50] IS NULL AND t0.[90] IS NOT NULL THEN t0.[90]
WHEN T0.[50] IS NULL AND t0.[100] IS NOT NULL THEN t0.[100]
ELSE T0.[50] END AS DaysTo50Percent,
CASE 
WHEN T0.[60] IS NULL AND t0.[70] IS NOT NULL THEN t0.[70]
WHEN T0.[60] IS NULL AND t0.[80] IS NOT NULL THEN t0.[80]
WHEN T0.[60] IS NULL AND t0.[90] IS NOT NULL THEN t0.[90]
WHEN T0.[60] IS NULL AND t0.[100] IS NOT NULL THEN t0.[100]
ELSE T0.[60] END AS DaysTo60Percent,
CASE 
WHEN T0.[70] IS NULL AND t0.[80] IS NOT NULL THEN t0.[80]
WHEN T0.[70] IS NULL AND t0.[90] IS NOT NULL THEN t0.[90]
WHEN T0.[70] IS NULL AND t0.[100] IS NOT NULL THEN t0.[100]
ELSE T0.[70] END AS DaysTo70Percent,
CASE 
WHEN T0.[80] IS NULL AND t0.[90] IS NOT NULL THEN t0.[90]
WHEN T0.[80] IS NULL AND t0.[100] IS NOT NULL THEN t0.[100]
ELSE T0.[80] END AS DaysTo80Percent,
CASE 
WHEN T0.[90] IS NULL AND t0.[100] IS NOT NULL THEN t0.[100]
ELSE T0.[90] END AS DaysTo90Percent,
t0.[100] AS DaysTo100Percent
FROM LocalWAProd.dbo.CDPGetDriversInspectingEngagementStats AS T0
INNER JOIN Salesforce.dbo.account AS A ON t0.salesforce_account_id = a.id
INNER JOIN salesforce.dbo.[User] AS u ON a.OwnerId = u.id
LEFT OUTER JOIN salesforce.dbo.[User] AS u1 ON a.Onboarding_Specialist_UserLook__c = u1.id
WHERE 
a.pISU__c >= DATEADD(MONTH, -12, GETDATE())  -- april 1st 2022 started addoption 
AND a.type = 'Customer'
--AND t0.business_id = 32221

